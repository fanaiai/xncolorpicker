"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function dynamicLoadJs(t){for(var o=0;o<t.length;o++){var r=t[o],r=(document.getElementsByTagName("head")[0],'<script type="text/javascript" src='+(document.createElement("script").src=r)+"><\/script>");document.write(r)}}function dynamicLoadCss(t){for(var o=0;o<t.length;o++){var r=t[o],e=document.getElementsByTagName("head")[0],i=document.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=r,e.appendChild(i)}}var scripts=document.getElementsByTagName("script"),script=scripts[scripts.length-1],s=document.querySelector?script.src:script.getAttribute("src",4),csspath=s.substr(0,+s.lastIndexOf("/")),jslist=[csspath+"/jquery.min.js",csspath+"/colorFormat.min.js"];dynamicLoadJs(jslist);var csslist=[csspath+"/xncolorpicker.css","//at.alicdn.com/t/font_2330183_hjqs7adohe.css"];dynamicLoadCss(csslist),function(r){var o={color:"#ffffff",selector:"",showprecolor:!0,prevcolors:["#EF534F","#BA69C8","#FFD54F","#81C784","#7FDEEA","#90CAF9","#F44436","#AB47BC","#FFC106","#66BB6A","#25C6DA","#4EC3F7","#E53934","#9D27B0","#FFA726","#4CAF50","#00ACC1","#29B6F6","#D32E30","#8F24AA","#FB8C01","#378E3C","#0097A7","#02AAF4","#C62928","#7B1FA2","#F57C02","#2F7D31","#00838F","#029BE5","#B71B1C","#6A1B9A","#EF6C00","#34691D","#006164","#0388D1","#980A0B","#4A148C","#E65100","#1A5E20","#004D41","#01579B","#00000000","#FFFFFF","#DBDBDB","#979797","#606060","#000000"],showhistorycolor:!0,historycolornum:16,format:"rgba",showPalette:!0,show:!1,alwaysShow:!1,lang:"cn",colorTypeOption:"single,linear-gradient,radial-gradient",canMove:!0,autoConfirm:!1};function t(t){this.pos={left:0,top:0},this.moved=!1,this.id=this.getRandomString(),this.btns={cn:["取消","确定"],en:["Cancel","OK"]},this.colorTypeList={cn:{single:"纯色","linear-gradient":"线性渐变","radial-gradient":"径向渐变"},en:{single:"Solid","linear-gradient":"Linear","radial-gradient":"Radial"}},this.option=$.extend(!0,{},o,t),t.prevcolors?this.option.prevcolors=t.prevcolors:this.option.prevcolors=o.prevcolors,this.option.colorTypeOption=this.option.colorTypeOption?this.option.colorTypeOption.split(","):["single","linear-gradient","radial-gradient"],this.currentColorFormat=this.option.format,this.option.selector,this.$el=$(this.option.selector),this.lastColor=this.option.color,this.initCurrentColorBox()}t.prototype={getRandomString:function(t){t=t||8;for(var o="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz",r=o.length,e="",i=0;i<t;i++)e+=o.charAt(Math.floor(Math.random()*r));return e},initCurrentColorBox:function(){var o=this;this.curcolordom=document.createElement("div"),this.curcolordom.classList.add("fcolorpicker-curbox"),this.curcolordom.style.background=this.option.color,this.$el.empty().append(this.curcolordom),o.init(),this.curcolordom.onclick=function(t){o.changeShow()},this.option.show&&$(o.dom).show()},changeShow:function(t){$(this.dom)&&"block"==$(this.dom).css("display")||t?this.option.alwaysShow||($(this.dom).empty(),$(this.dom).hide(),this.moved=!1):(this.init(),$(this.dom).show())},init:function(){this.initDom(),this.initColorFormat(),this.option.showPalette?(this.initPalette(),this.initColorBand(),this.initOpacity()):this.dom.querySelector(".color-palette").style.display="none",this.setPrevColors(),this.getHistoryColors(),this.setPosition(),this.addPosEvent(),this.changeColorFormatType(),$(this.dom).hide()},rendGradientDom:function(){},initDom:function(){var t=!0,o=document.body.querySelector(".fcolorpicker#"+this.id);o||((o=document.createElement("div")).classList.add("fcolorpicker"),this.option.canMove&&o.classList.add("canmove"),o.id=this.id,t=!1);for(var r="",e=0;e<this.option.colorTypeOption.length;e++){var i=this.option.colorTypeOption[e];r+='<li class="color-type-item" data-type="'+i+'">'+this.colorTypeList[this.option.lang][i]+"</li>"}var n='\n            <div class="color-type color-slidedown iconfontcolorpicker iconcolorpickerxiala">\n               <p class="color-slidedown-curbox"></p>\n               <ul>\n                   '+r+'\n               </ul>\n            </div>\n            <div class="color-gradient">\n                <div class="gradient-bar-container">\n                    <div class="gradient-colors">\n                        <div class="gradient-item iconfontcolorpicker iconcolorpicker1" style="left:10%">\n                            <div class="color"></div>\n                        </div>\n                        <div class="gradient-item iconfontcolorpicker iconcolorpicker1" style="left:20%">\n                            <div class="color"></div>\n                        </div>\n                    </div>\n                    <div class="gradient-bar">\n                        <span></span>\n                    </div>\n                    <a class="add-gradient iconfontcolorpicker iconcolorpicker11"></a>\n                </div>\n                <div class="gradient-angle">\n                    <div class="current-angle">\n                      <div class="angle-bar"></div>\n                      <span>30°</span>\n</div>\n</div>\n            </div>\n            <div class="color-palette">\n                <div class="lightness">\n                    <div class="lightbar"></div>\n                </div>\n                <div class="hue">\n                    <div class="huebar"></div>\n                </div>\n                <div class="opacity">\n                    <div class="opacitybar"></div>\n                </div>\n            </div>\n            \x3c!--            <p>最近使用</p>--\x3e\n            <div class="color-latest fcolor-list">\n            </div>\n\x3c!--            <p>预置颜色</p>--\x3e\n            <div class="color-recommend fcolor-list">\n            </div>\n\n            <div class="color-btns">\n                <div class="color-preview">\n                    <div class="color-format-type color-slidedown iconfontcolorpicker iconcolorpickerxiala">\n                       <p class="color-slidedown-curbox">RGBA</p>\n                       <ul>\n                        <li class="color-format-type-item" data-type="rgba">RGBA</li>\n                        <li class="color-format-type-item" data-type="hex">HEX</li>\n                        <li class="color-format-type-item" data-type="hsla">HSLA</li>\n                       </ul>\n                    </div>\n                    <div class="current-color"></div>\n                    <div class="current-color-value">\n                        <input type="text" onfocus="this.select()">\n                    </div>\n                </div>\n                \n                <div class="color-btn-group">\n                    <a class="cancel-color">'+this.btns[this.option.lang][0]+'</a>\n                    <a class="confirm-color">'+this.btns[this.option.lang][1]+"</a>\n                </div>\n            </div>";o.innerHTML=n,this.dom=o,document.body.appendChild(this.dom),this.canvasSize={width:212,height:129},this.lightbar=this.dom.querySelector(".lightbar"),this.huebar=this.dom.querySelector(".huebar"),this.opacitybar=this.dom.querySelector(".opacitybar"),this.option.showprecolor||$(this.dom).find(".color-recommend").hide(),this.option.showhistorycolor||$(this.dom).find(".color-latest").hide(),this.option.colorTypeOption.length<2&&$(this.dom).find(".color-type").remove(),this.setPosition(),t||this.addEvent(),this.addBlurEvent()},addPosEvent:function(){var t=this;r.addEventListener("scroll",function(){t.setPosition()}),r.addEventListener("resize",function(){t.setPosition()})},moveDom:function(t,o){var r;this.dom&&(this.moved=!0,r=o.clientX-t.x+this.pos.left,t=o.clientY-t.y+this.pos.top,this.dom.style.top=t+"px",this.dom.style.left=r+"px")},setPosition:function(){var t,o,r,e,i,n,s;this.dom&&!this.moved&&(t=document.documentElement.clientWidth,o=document.documentElement.clientHeight,e=(r=this.$el[0].querySelector("div")).getBoundingClientRect().top,s=r.getBoundingClientRect().left,i=$(this.dom).outerWidth(),n=$(this.dom).outerHeight(),s=t-s<=i?s-i-10:s+10+r.offsetWidth,(e=o-e<n?e-n-r.offsetHeight:e)<10&&(e=10),this.dom.style.top=e+"px",this.dom.style.left=s+"px",this.pos={left:s,top:e})},addHistoryColors:function(){for(var t=this.color[this.currentColorFormat],o=0;o<this.hiscolors.length;o++)if(colorFormat({color:this.hiscolors[o],format:this.currentColorFormat}).complete==t){this.hiscolors.splice(o,1);break}this.hiscolors.unshift(t),r.localStorage.setItem("fcolorpicker",this.hiscolors.join(";")),this.rendHisColors(),this.setPosition()},getHistoryColors:function(){var t=r.localStorage.getItem("fcolorpicker");this.hiscolors=(t||"").split(";"),this.rendHisColors()},clearHistoryColors:function(){this.hiscolors=[],r.localStorage.setItem("fcolorpicker",this.hiscolors.join(";")),this.rendHisColors(),this.setPosition()},rendHisColors:function(){if(this.option.showhistorycolor){$(this.dom).find(".color-latest").empty();for(var t,o=0;o<(this.option.historycolornum<0?this.hiscolors.length:this.option.historycolornum);o++)this.hiscolors[o]&&""!=this.hiscolors[o]&&(t='\n                    <div class="color-item" data-color="'+this.hiscolors[o]+'">\n                    <span style="background:'+this.hiscolors[o]+'"></span>\n</div>\n                ',$(this.dom).find(".color-latest").append(t))}},setPrevColors:function(){if(this.option.showprecolor)for(var t=0;t<this.option.prevcolors.length;t++){var o='\n                    <div class="color-item" data-color="'+this.option.prevcolors[t]+'">\n                    <span style="background:'+this.option.prevcolors[t]+'"></span>\n</div>\n                ';$(this.dom).find(".color-recommend").append(o)}},addBlurEvent:function(){var o=this;this.dom.querySelector("input").onblur=function(t){o.initColorFormat(o.dom.querySelector(".current-color-value input").value),o.fillOpacity(),o.fillPalette(),o.addHistoryColors()}},cancleFun:function(){this.initColorFormat(this.lastColor,!0);var t={colorType:this.currentColorType};"single"==this.currentColorType?(t.color=this.color,this.lastColor=this.color.rgba):(t.color=this.gradientColor,this.lastColor=this.gradientColor.str),this.changeCurColorDom(),this.option.onCancel(t),this.changeShow(!0)},getCurrentColor:function(t){this.initColorFormat(this.dom.querySelector(".current-color-value input").value,!0),this.addHistoryColors();var o={colorType:this.currentColorType};return"single"==this.currentColorType?(o.color=this.color,t&&(this.lastColor=this.color.rgba)):(o.color=this.gradientColor,t&&(this.lastColor=this.gradientColor.str)),this.changeCurColorDom(),o},addEvent:function(){var e=this,i=null,n=this,s={top:0,left:0,bartop:0,isGradientBar:!1,$ele:null};n.dom.addEventListener("mousedown",function(t){var o,r=$(t.target);i=null,0<r.parents(".lightness").length&&(i="lightness"),0<r.parents(".hue").length&&(i="hue",o=100*t.offsetY/n.canvasSize.height,n.huebar.style.top=o.toFixed(2)+"%",s.bartop=parseFloat(n.huebar.style.top)),0<r.parents(".opacity").length&&(i="opacity",o=100*t.offsetY/n.canvasSize.height,n.opacitybar.style.top=o.toFixed(2)+"%",s.bartop=parseFloat(n.opacitybar.style.top)),s.x=t.clientX,s.y=t.clientY,i&&n.changeColor(i,t,null),(r=r.parents(".gradient-item")[0]?r.parents(".gradient-item"):r).hasClass("gradient-item")&&(s.isGradientBar=!0,e.gradientIndex=r.index(),e.updateGradientBar(),e.setCurrentGradientColor(),s.$ele=r),r.hasClass("add-gradient")&&(e.gradientColor.arry.colors.push({per:100,color:"#ffffff"}),e.gradientColor=e.revertGradientToString(e.gradientColor.arry),e.gradientIndex=e.gradientColor.arry.colors.length-1,e.rendInputValue(),e.rendGradientColors(),e.updateGradientBar()),r.hasClass("angle-bar")&&(s.isGradientBar=!1,s.isAngleBar=!0),r[0]==e.dom&&e.option.canMove?s.isMove=!0:s.isMove=!1}),document.addEventListener("mousemove",function(t){var o;i?n.changeColor(i,t,s):s.isGradientBar?(o=(100*(t.clientX-$(e.dom).find(".gradient-colors")[0].getBoundingClientRect().left)/$(e.dom).find(".gradient-colors")[0].getBoundingClientRect().width).toFixed(1),e.gradientColor.arry.colors.length<3?(o=100<o?100:o)<0&&(o=0):-5<=(o=100<o&&o<=105?100:o)&&o<0&&(o=0),e.gradientColor.arry.colors[e.gradientIndex].per=o,s.$ele.css({left:o+"%"}),e.updateGradientColors(!0),e.changeCurColorDom(),o<-5||105<o?s.$ele.addClass("deleting-item"):s.$ele.removeClass("deleting-item")):s.isAngleBar&&(360<(o=(o=(360*(t.clientX-$(e.dom).find(".gradient-angle")[0].getBoundingClientRect().left)/$(e.dom).find(".gradient-angle")[0].getBoundingClientRect().width).toFixed(1))<0?0:o)&&(o=360),e.gradientColor.arry.angle=o,e.updateAngleBar(),e.updateGradientColors(),e.changeCurColorDom()),s.isMove&&e.moveDom(s,t)}),document.addEventListener("mouseup",function(t){var o;s.isGradientBar&&(o=(100*(t.clientX-$(e.dom).find(".gradient-colors")[0].getBoundingClientRect().left)/$(e.dom).find(".gradient-colors")[0].getBoundingClientRect().width).toFixed(1),2<e.gradientColor.arry.colors.length&&(105<o||o<-5)&&(e.gradientColor.arry.colors.splice(e.gradientIndex,1),s.$ele.remove(),e.updateGradientBar(),e.gradientColor=e.revertGradientToString(e.gradientColor.arry),e.rendInputValue()),o=n.getCurrentColor(e.option.autoConfirm),n.option.onChange(o),e.option.autoConfirm&&e.option.onConfirm(o)),(i||s.isAngleBar)&&(o=n.getCurrentColor(e.option.autoConfirm),n.option.onChange(o),e.option.autoConfirm&&e.option.onConfirm(o)),i=null,s.isGradientBar=!1,s.isAngleBar=!1,s.isMove&&(o=t.clientX-s.x+e.pos.left,t=t.clientY-s.y+e.pos.top,e.pos.left=o,e.pos.top=t),s.isMove=!1}),this.dom.addEventListener("click",function(t){t.stopPropagation();var o,t=$(t.target);if(t.hasClass("color-item")){n.getColorFormat(t.attr("data-color")),n.fillOpacity(),n.fillPalette(),n.addHistoryColors(),"single"!=e.currentColorType&&(e.updateGradientColors(),e.changeCurColorDom());var r=n.getCurrentColor(e.option.autoConfirm);return n.option.onChange(r),void(e.option.autoConfirm&&e.option.onConfirm(r))}if(t.hasClass("cancel-color")&&e.cancleFun(),t.hasClass("confirm-color")){r=n.getCurrentColor(!0);return n.option.onConfirm(r),void n.changeShow(!0)}(t=t.hasClass("color-slidedown-curbox")?t.parent():t).hasClass("color-slidedown")&&(t.hasClass("down")?t.removeClass("down"):t.addClass("down")),t.hasClass("color-type-item")&&(t.hasClass("on")?t.parents(".color-slidedown").removeClass("down"):(o=t.attr("data-type"),e.currentColorType=o,e.changeColorType())),t.hasClass("color-format-type-item")&&(t.hasClass("on")?t.parents(".color-slidedown").removeClass("down"):(o=t.attr("data-type"),e.currentColorFormat=o,e.changeColorFormatType()))});function t(t){t.stopPropagation(),n.dom&&t.target!=n.dom&&$(t.target).parents(".fcolorpicker")[0]!=n.dom&&$(t.target)[0]!=n.curcolordom&&"block"==$(n.dom).css("display")&&n.cancleFun(),$(e.dom).find(".color-slidedown").not($(t.target).parents(".color-slidedown")[0]).removeClass("down")}this.removeMouseDownEvent=function(){document.removeEventListener("mousedown",t)},document.addEventListener("mousedown",t)},changeColor:function(t,o,r){if(t){var e=o.offsetX,i=o.offsetY;if(r){var n=100*(o.clientY-r.y)/this.canvasSize.height+r.bartop;if(99.9<n&&"lightness"!=t)return;n<0&&(n=0)}else n=(100*o.offsetY/this.canvasSize.height).toFixed(2);switch(t){case"hue":this.huebar.style.top=n+"%",c="hsla("+360*n/100+","+this.color.hslav[1]+"%,"+this.color.hslav[2]+"%,"+this.color.hslav[3]+")";break;case"lightness":e=o.clientX-this.dom.querySelector(".lightness").getBoundingClientRect().left;(i=o.clientY-this.dom.querySelector(".lightness").getBoundingClientRect().top)<0&&(i=0),(e=e<0?0:e)>this.dom.querySelector(".lightness canvas").getBoundingClientRect().width&&(e=this.dom.querySelector(".lightness canvas").getBoundingClientRect().width),i>this.dom.querySelector(".lightness canvas").getBoundingClientRect().height&&(i=this.dom.querySelector(".lightness canvas").getBoundingClientRect().height);var s=this.color.hslav[0],l=e/this.canvasSize.width*100,a=100-i/this.canvasSize.height*100,a=this.HSBToRGB({h:s,s:l,b:a}),c="rgba("+a.r+","+a.g+","+a.b+","+this.color.rgbav[3]+")";this.lightbar.style.top=i+"px",this.lightbar.style.left=e+"px";break;case"opacity":n=99.2<n?100:n,this.opacitybar.style.top=n+"%",c="rgba("+this.color.rgbav[0]+","+this.color.rgbav[1]+","+this.color.rgbav[2]+","+((100-n)/100).toFixed(2)+")"}this.getColorFormat(c),"hue"==t&&(this.fillOpacity(),this.fillPalette()),this.setPosition(),"single"!=this.currentColorType&&this.updateGradientColors(),this.changeCurColorDom()}},HSBToRGB:function(t){var o={},r=t.h,e=255*t.s/100,i=255*t.b/100;return 0==e?o.r=o.g=o.b=i:(i=r%60*((t=i)-(e=(255-e)*i/255))/60,(r=360==r?0:r)<60?(o.r=t,o.b=e,o.g=e+i):r<120?(o.g=t,o.b=e,o.r=t-i):r<180?(o.g=t,o.r=e,o.b=e+i):r<240?(o.b=t,o.r=e,o.g=t-i):r<300?(o.b=t,o.g=e,o.r=e+i):r<360?(o.r=t,o.g=e,o.b=t-i):(o.r=0,o.g=0,o.b=0)),{r:Math.round(o.r),g:Math.round(o.g),b:Math.round(o.b)}},updateGradientColors:function(t){this.gradientColor.arry.colors[this.gradientIndex].color=this.color.rgba,this.updateGradientBar(),this.updateGradientColorItem(this.gradientIndex,this.color.rgba),this.gradientColor=this.revertGradientToString(this.gradientColor.arry),this.rendInputValue(),t||this.rendGradientColors()},rendInputValue:function(){"single"!=this.currentColorType?(this.dom.querySelector(".current-color").style.background=this.gradientColor.str,this.dom.querySelector(".current-color-value input").value=this.gradientColor.str):(this.dom.querySelector(".current-color").style.background=this.color[this.currentColorFormat],this.dom.querySelector(".current-color-value input").value=this.color[this.currentColorFormat])},initColorBand:function(){var t=document.createElement("canvas");this.ctxhue=t.getContext("2d"),t.width=10,t.height=this.canvasSize.height,this.dom.querySelector(".color-palette .hue").appendChild(t),this.ctxhue.rect(0,0,10,this.canvasSize.height);t=this.ctxhue.createLinearGradient(0,0,0,this.canvasSize.height);t.addColorStop(0,"rgba(255, 0, 0, 1)"),t.addColorStop(.17,"rgba(255, 255, 0, 1)"),t.addColorStop(.34,"rgba(0, 255, 0, 1)"),t.addColorStop(.51,"rgba(0, 255, 255, 1)"),t.addColorStop(.68,"rgba(0, 0, 255, 1)"),t.addColorStop(.85,"rgba(255, 0, 255, 1)"),t.addColorStop(1,"rgba(255, 0, 0, 1)"),this.ctxhue.fillStyle=t,this.ctxhue.fill()},initOpacity:function(){var t=document.createElement("canvas");this.ctxopacity=t.getContext("2d"),t.width=10,t.height=this.canvasSize.height,this.dom.querySelector(".color-palette .opacity").appendChild(t),this.fillOpacity()},fillOpacity:function(){var t;this.ctxopacity&&(this.ctxopacity.clearRect(0,0,10,this.canvasSize.height),(t=this.ctxlightness.createLinearGradient(0,0,10,this.canvasSize.height)).addColorStop(0,"rgba("+this.color.rgbav[0]+","+this.color.rgbav[1]+","+this.color.rgbav[2]+",1)"),t.addColorStop(1,"rgba("+this.color.rgbav[0]+","+this.color.rgbav[1]+","+this.color.rgbav[2]+",0)"),this.ctxopacity.fillStyle=t,this.ctxopacity.fillRect(0,0,10,this.canvasSize.height))},initPalette:function(){this.canvas=document.createElement("canvas"),this.ctxlightness=this.canvas.getContext("2d"),this.canvas.width=this.canvasSize.width,this.canvas.height=this.canvasSize.height,this.dom.querySelector(".color-palette .lightness").appendChild(this.canvas),this.fillPalette()},fillPalette:function(){var t,o,r;this.ctxlightness&&(this.ctxlightness.fillStyle="hsla("+this.color.hslav[0]+",100%,50%,1)",t=this.canvasSize.width,o=this.canvasSize.height,this.ctxlightness.fillRect(0,0,t,o),(r=this.ctxlightness.createLinearGradient(0,0,t,0)).addColorStop(0,"rgba(255,255,255,1)"),r.addColorStop(1,"rgba(255,255,255,0)"),this.ctxlightness.fillStyle=r,this.ctxlightness.fillRect(0,0,t,o),(r=this.ctxlightness.createLinearGradient(0,0,0,o)).addColorStop(0,"rgba(0,0,0,0)"),r.addColorStop(1,"rgba(0,0,0,1)"),this.ctxlightness.fillStyle=r,this.ctxlightness.fillRect(0,0,t,o),this.updatelightbar())},updatelightbar:function(){this.lightbar=this.dom.querySelector(".lightbar");var t=this.RGBToHSB({r:this.color.rgbav[0],g:this.color.rgbav[1],b:this.color.rgbav[2]}),o=t.s*this.canvasSize.width/100,t=(100-t.b)*this.canvasSize.height/100;this.lightbar.style.top=t+"px",this.lightbar.style.left=o+"px"},RGBToHSB:function(t){var o={h:0,s:0,b:0},r=Math.min(t.r,t.g,t.b),e=Math.max(t.r,t.g,t.b),i=e-r;return o.b=e,o.s=0!=e?255*i/e:0,0!=o.s?t.r==e?o.h=(t.g-t.b)/i:t.g==e?o.h=2+(t.b-t.r)/i:o.h=4+(t.r-t.g)/i:o.h=-1,e==r&&(o.h=0),o.h*=60,o.h<0&&(o.h+=360),o.s*=100/255,o.b*=100/255,o},setColor:function(t){this.option.color=t,this.getColorFormat(t)},getColor:function(t){return this.color},initColorFormat:function(t,o){"object"==(void 0===(t=t||this.lastColor)?"undefined":_typeof(t))?(this.gradientColor=this.revertGradientToString(t),-1<this.gradientColor.str.indexOf("linear-gradient")?this.currentColorType="linear-gradient":this.currentColorType="radial-gradient"):-1<t.toLowerCase().indexOf("linear-gradient")||-1<t.toLowerCase().indexOf("radial-gradient")?(this.gradientColor=this.revertGradientToArray(t),-1<this.gradientColor.str.indexOf("linear-gradient")?this.currentColorType="linear-gradient":this.currentColorType="radial-gradient"):(this.getColorFormat(t||"#000"),this.currentColorType="single"),o||(this.changeColorType(!0),"single"!=this.currentColorType&&(this.setCurrentGradientColor(),this.updateAngleBar(),this.updateGradientColors(),this.rendGradientColors()))},setCurrentGradientColor:function(){this.getColorFormat(this.gradientColor.arry.colors[this.gradientIndex].color),this.fillPalette()},updateAngleBar:function(){$(this.dom).find(".current-angle span").html(this.gradientColor.arry.angle+"°"),$(this.dom).find(".current-angle .angle-bar").css("left",this.gradientColor.arry.angle/3.6+"%")},updateGradientColorItem:function(t,o){$(this.dom).find(".gradient-item").eq(t).find(".color").css("background",o)},updateGradientBar:function(){var t=this.revertGradientToString(this.gradientColor.arry,!0);$(this.dom).find(".gradient-bar span").css("background",t.str),$(this.dom).find(".gradient-item").removeClass("on").eq(this.gradientIndex).addClass("on")},rendGradientColors:function(){for(var t="",o=0;o<this.gradientColor.arry.colors.length;o++)t+='<div class="gradient-item iconfontcolorpicker iconcolorpicker1" style="left:'+this.gradientColor.arry.colors[o].per+'%">\n                            <div class="color" style="background:'+this.gradientColor.arry.colors[o].color+'"></div>\n                        </div>';$(this.dom).find(".gradient-colors").empty().append(t),$(this.dom).find(".gradient-item").removeClass("on").eq(this.gradientIndex).addClass("on")},setColorTypeDom:function(){$(this.dom).find(".color-type")[0]&&($(this.dom).find(".color-type li").removeClass("on"),$(this.dom).find(".color-type-item[data-type="+this.currentColorType+"]").addClass("on"),$(this.dom).find(".color-type").removeClass("down"),$(this.dom).find(".color-type .color-slidedown-curbox")[0].innerHTML=$(this.dom).find(".color-type-item[data-type="+this.currentColorType+"]")[0].innerHTML)},changeColorFormatType:function(){$(this.dom).find(".color-format-type li").removeClass("on"),$(this.dom).find(".color-format-type-item[data-type="+this.currentColorFormat+"]").addClass("on"),$(this.dom).find(".color-format-type").removeClass("down"),$(this.dom).find(".color-format-type .color-slidedown-curbox")[0].innerHTML=$(this.dom).find(".color-format-type-item[data-type="+this.currentColorFormat+"]")[0].innerHTML;var t=this.getCurrentColor(this.option.autoConfirm);this.rendInputValue(),this.option.onChange(t),this.option.autoConfirm&&this.option.onConfirm(t)},changeColorType:function(t){this.gradientIndex=0;var o=this.option.colorTypeOption.indexOf(this.currentColorType)<0;o&&(this.currentColorType=this.option.colorTypeOption[0]),"single"==this.currentColorType?(t&&!o||this.getColorFormat(this.gradientColor?this.gradientColor.arry.colors[0].color:"#ffffff"),$(this.dom).find(".color-gradient").hide()):(t&&!o||this.gradientColor||(this.gradientColor={type:this.currentColorType},this.initColorFormat({type:this.currentColorType,angle:0,colors:[{per:0,color:this.color.rgba},{per:100,color:"rgba(0,0,0,0)"}]})),this.gradientColor.arry.type!=this.currentColorType&&(this.gradientColor.arry.type=this.currentColorType,this.gradientColor=this.revertGradientToString(this.gradientColor.arry)),$(this.dom).find(".color-gradient").show(),this.rendGradientColors(),this.updateGradientBar(),this.updateAngleBar(),this.changeCurColorDom(),"linear-gradient"==this.currentColorType?$(this.dom).find(".gradient-angle").show():$(this.dom).find(".gradient-angle").hide()),this.setColorTypeDom(),this.rendInputValue(),this.setPosition()},getColorFormat:function(t){this.color=this.getColorFormatFunc(t),this.color.rgbav=this.color.rgba.slice(5,this.color.rgba.indexOf(")")).split(","),this.color.hslav=this.color.hsla.slice(5,this.color.hsla.indexOf(")")).split(",").map(function(t){return-1<t.indexOf("%")?t.slice(0,t.indexOf("%")):t}),this.dom&&("single"==this.currentColorType&&(this.changeCurColorDom(),this.dom.querySelector(".current-color").style.background=this.color.rgba,this.dom.querySelector(".current-color-value input").value=this.color[this.currentColorFormat]),this.setBarPos())},changeCurColorDom:function(){"single"==this.currentColorType?this.curcolordom.style.background=this.color.rgba:this.curcolordom.style.background=this.gradientColor.str},getColorFormatFunc:function(t){t.indexOf("rgb")<0&&t.indexOf("#")<0&&t.indexOf("hsl")<0&&(t="rgba(0,0,0,0)");t={rgba:colorFormat({color:t,format:"rgba"}).complete,hsla:colorFormat({color:t,format:"hsla"}).complete,hex:colorFormat({color:t,format:"hex"}).complete};return!t.rgba||-1<t.rgba.indexOf("NaN")?this.dom?void(this.dom.querySelector(".current-color-value input").value=this.color[this.currentColorFormat]):void 0:t},setBarPos:function(){this.opacitybar.style.top=100*(1-this.color.rgbav[3])+"%",0!=parseFloat(this.color.hslav[1])&&(this.huebar.style.top=100*this.color.hslav[0]/360+"%")},replace:function(){var t=""+(arguments.length<=0?void 0:arguments[0]);return arguments.length<3?t:t.replace(arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},revertGradientToArray:function(t){var o=this,r="";t=t.toLowerCase();t=this.replace(t,/(rgba\(.*?\))/gi,function(t){return o.getColorFormatFunc(t).hex}),-1<(t=this.replace(t,/(hsla\(.*?\))/gi,function(t){return o.getColorFormatFunc(t).hex})).toLowerCase().indexOf("radial-gradient")&&(r="radial-gradient"),-1<t.toLowerCase().indexOf("linear-gradient")&&(r="linear-gradient");for(var e=t.slice(t.toLowerCase().indexOf(r)+16,t.toLowerCase().lastIndexOf(")")).split(",").map(function(t){return t.trim()}),i={type:r,angle:"linear-gradient"==r?parseFloat(e[0]).toFixed(0):0,colors:[]},n="linear-gradient"==r?1:0;n<e.length;n++){var s=e[n].split(" ");i.colors.push({color:s[0],per:s[1]?parseFloat(s[1]):100*(n-1)/(e.length-2)})}return{str:this.revertGradientToString(i).str,arry:i}},revertGradientToString:function(t,o){var r=(o?"linear-gradient":t.type)+"(";o?r+="to right,":"linear-gradient"==t.type&&(r+=parseFloat(t.angle).toFixed(1)+"deg,");for(var e=0;e<t.colors.length;e++){var i=this.getColorFormatFunc(t.colors[e].color)[this.currentColorFormat];r+=(t.colors[e].color=i)+" "+parseFloat(t.colors[e].per).toFixed(1),""!=t.colors[e].per&&(r+="%"),e<t.colors.length-1&&(r+=",")}return{str:r+=")",arry:t}},$copy:function(t){var o=document.createElement("textarea");o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.width="2em",o.style.height="2em",o.style.padding="0",o.style.border="none",o.style.outline="none",o.style.boxShadow="none",o.style.background="transparent",o.value=t,document.body.appendChild(o),o.select();try{var r=document.execCommand("copy")?"成功复制到剪贴板":"该浏览器不支持点击复制到剪贴板";layer.msg(r,{skin:"suclayer"})}catch(t){layer.msg("该浏览器不支持点击复制到剪贴板",{skin:"errorlayer"})}document.body.removeChild(o)},destroy:function(){$(this.dom).remove(),this.removeMouseDownEvent(),this.curcolordom.onclick=null}},r.XNColorPicker=t}(window);